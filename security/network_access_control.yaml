# ============================================================================
# NETWORK ACCESS CONTROL CONFIGURATION
# ============================================================================
# This file controls ALL network access for the entire codebase.
# By default, ALL requests are DENIED for security monitoring.
# Gradually whitelist trusted clients after analysis.
# ============================================================================

version: "1.0.0"
last_updated: "2024-01-01"
mode: "strict"  # strict, permissive, audit
default_policy: "deny"  # deny, allow

# ============================================================================
# GLOBAL SETTINGS
# ============================================================================
global:
  # Enable/disable all network access globally
  network_enabled: false

  # Logging and monitoring
  logging:
    enabled: true
    log_level: "DEBUG"  # DEBUG, INFO, WARNING, ERROR
    log_file: "security/logs/network_access.log"
    log_blocked_requests: true
    log_allowed_requests: true
    log_failed_requests: true

  # Alert on suspicious activity
  alerts:
    enabled: true
    alert_on_blocked: true
    alert_on_new_endpoint: true
    alert_on_data_leak: true
    alert_threshold: 10  # Number of blocked requests before alert

  # Rate limiting
  rate_limiting:
    enabled: true
    max_requests_per_minute: 100
    max_requests_per_hour: 1000

  # Request timeout (seconds)
  timeout:
    default: 30
    max: 300

# ============================================================================
# HTTP/HTTPS CLIENT RULES
# ============================================================================
http_clients:
  # Default policy for all HTTP clients
  default_policy: "deny"

  # Requests library
  requests:
    enabled: false
    allowed_domains: []
    blocked_domains: ["*"]  # Block all by default
    allowed_ips: []
    blocked_ips: []

  # HTTPX library
  httpx:
    enabled: false
    allowed_domains: []
    blocked_domains: ["*"]
    allowed_ips: []
    blocked_ips: []

  # aiohttp library
  aiohttp:
    enabled: false
    allowed_domains: []
    blocked_domains: ["*"]
    allowed_ips: []
    blocked_ips: []

  # urllib library
  urllib:
    enabled: false
    allowed_domains: []
    blocked_domains: ["*"]
    allowed_ips: []
    blocked_ips: []

# ============================================================================
# EXTERNAL API ACCESS RULES
# ============================================================================
external_apis:
  # CoinGecko API
  coingecko:
    enabled: false
    base_url: "https://api.coingecko.com"
    allowed_endpoints: []
    blocked_endpoints: ["*"]
    require_api_key: false
    api_key_env_var: ""

  # Binance API
  binance:
    enabled: false
    base_url: "https://api.binance.com"
    allowed_endpoints: []
    blocked_endpoints: ["*"]
    require_api_key: false
    api_key_env_var: ""

  # Coinbase API
  coinbase:
    enabled: false
    base_url: "https://api.coinbase.com"
    allowed_endpoints: []
    blocked_endpoints: ["*"]
    require_api_key: false
    api_key_env_var: ""

  # GitHub API
  github:
    enabled: false
    base_url: "https://api.github.com"
    allowed_endpoints: []
    blocked_endpoints: ["*"]
    require_api_key: true
    api_key_env_var: "GITHUB_TOKEN"

  # Google Gemini API
  gemini:
    enabled: false
    base_url: "https://generativelanguage.googleapis.com"
    allowed_endpoints: []
    blocked_endpoints: ["*"]
    require_api_key: true
    api_key_env_var: "GEMINI_API_KEY"

  # OpenAI API
  openai:
    enabled: false
    base_url: "https://api.openai.com"
    allowed_endpoints: []
    blocked_endpoints: ["*"]
    require_api_key: true
    api_key_env_var: "OPENAI_API_KEY"

  # Ollama (Local)
  ollama:
    enabled: false
    base_url: "http://localhost:11434"
    allowed_endpoints: []
    blocked_endpoints: ["*"]
    require_api_key: false
    api_key_env_var: ""

  # Databricks
  databricks:
    enabled: false
    base_url: ""  # Set dynamically
    allowed_endpoints: []
    blocked_endpoints: ["*"]
    require_api_key: true
    api_key_env_var: "DATABRICKS_TOKEN"

# ============================================================================
# WEBSOCKET CONNECTION RULES
# ============================================================================
websockets:
  # Default policy for WebSocket connections
  default_policy: "deny"

  # Inbound WebSocket connections (server accepting clients)
  inbound:
    enabled: false
    allowed_origins: []
    blocked_origins: ["*"]
    require_authentication: true
    max_connections: 0  # 0 = disabled
    max_connections_per_ip: 0

  # Outbound WebSocket connections (client connecting to servers)
  outbound:
    enabled: false
    allowed_hosts: []
    blocked_hosts: ["*"]
    allowed_protocols: []  # ws, wss

  # Specific WebSocket endpoints
  endpoints:
    - path: "/api/cognitive/ws/updates/{correlation_id}"
      enabled: false
      require_auth: true
      allowed_origins: []

    - path: "/ws/feedback/{activity_id}"
      enabled: false
      require_auth: true
      allowed_origins: []

# ============================================================================
# EVENT BUS / MESSAGE QUEUE RULES
# ============================================================================
event_systems:
  # Internal event bus
  internal_event_bus:
    enabled: true  # Internal events allowed
    log_events: true
    allowed_event_types: ["*"]
    blocked_event_types: []

  # Redis Streams (if used)
  redis:
    enabled: false
    host: "localhost"
    port: 6379
    require_password: true

  # RabbitMQ (if used)
  rabbitmq:
    enabled: false
    host: "localhost"
    port: 5672
    require_auth: true

  # Kafka (if used)
  kafka:
    enabled: false
    brokers: []
    require_auth: true

# ============================================================================
# DATABASE CONNECTIONS
# ============================================================================
databases:
  # PostgreSQL
  postgresql:
    enabled: false
    allowed_hosts: []
    blocked_hosts: ["*"]
    require_ssl: true

  # MySQL
  mysql:
    enabled: false
    allowed_hosts: []
    blocked_hosts: ["*"]
    require_ssl: true

  # MongoDB
  mongodb:
    enabled: false
    allowed_hosts: []
    blocked_hosts: ["*"]
    require_auth: true

  # Redis
  redis:
    enabled: false
    allowed_hosts: []
    blocked_hosts: ["*"]
    require_password: true

  # Databricks SQL
  databricks_sql:
    enabled: false
    allowed_hosts: []
    blocked_hosts: ["*"]
    require_ssl: true

# ============================================================================
# SOCKET CONNECTIONS
# ============================================================================
sockets:
  # Raw TCP sockets
  tcp:
    enabled: false
    allowed_ports: []
    blocked_ports: ["*"]
    allowed_hosts: []
    blocked_hosts: ["*"]

  # UDP sockets
  udp:
    enabled: false
    allowed_ports: []
    blocked_ports: ["*"]
    allowed_hosts: []
    blocked_hosts: ["*"]

# ============================================================================
# FILE SYSTEM ACCESS (Network shares, NFS, etc.)
# ============================================================================
network_file_systems:
  # SMB/CIFS shares
  smb:
    enabled: false
    allowed_shares: []
    blocked_shares: ["*"]

  # NFS mounts
  nfs:
    enabled: false
    allowed_mounts: []
    blocked_mounts: ["*"]

  # FTP/SFTP
  ftp:
    enabled: false
    allowed_hosts: []
    blocked_hosts: ["*"]

# ============================================================================
# DNS QUERIES
# ============================================================================
dns:
  # Allow DNS resolution
  enabled: false
  log_queries: true
  allowed_domains: []
  blocked_domains: ["*"]
  use_system_resolver: false
  custom_resolvers: []

# ============================================================================
# DATA LEAK PREVENTION
# ============================================================================
data_leak_prevention:
  enabled: true

  # Scan outbound requests for sensitive data
  scan_requests: true

  # Patterns to detect (regex)
  sensitive_patterns:
    - pattern: "api[_-]?key"
      description: "API keys"
      action: "block"

    - pattern: "password"
      description: "Passwords"
      action: "block"

    - pattern: "secret"
      description: "Secrets"
      action: "block"

    - pattern: "token"
      description: "Tokens"
      action: "block"

    - pattern: "auth"
      description: "Authentication data"
      action: "block"

    - pattern: "[0-9]{3}-[0-9]{2}-[0-9]{4}"
      description: "SSN"
      action: "block"

    - pattern: "[0-9]{16}"
      description: "Credit card numbers"
      action: "block"

    - pattern: "Bearer [A-Za-z0-9-._~+/]+"
      description: "Bearer tokens"
      action: "block"

  # File types to block from upload
  blocked_file_extensions:
    - ".env"
    - ".key"
    - ".pem"
    - ".p12"
    - ".pfx"
    - ".crt"
    - ".csr"

  # Maximum data size for outbound requests (bytes)
  max_request_size: 10485760  # 10MB

  # Block requests with these headers
  blocked_headers:
    - "X-Internal-Secret"
    - "X-Admin-Token"

# ============================================================================
# MONITORING AND AUDIT
# ============================================================================
monitoring:
  # Audit trail
  audit:
    enabled: true
    log_file: "security/logs/audit.log"
    log_format: "json"

  # Metrics collection
  metrics:
    enabled: true
    collect_interval: 60  # seconds
    metrics_file: "security/logs/metrics.json"

  # Network traffic analysis
  traffic_analysis:
    enabled: true
    detect_anomalies: true
    baseline_period: 3600  # seconds
    alert_on_anomaly: true

# ============================================================================
# WHITELIST RULES (Empty by default - add trusted clients here)
# ============================================================================
whitelist:
  # Example: Allow specific domain after verification
  # - domain: "api.trusted-service.com"
  #   protocol: "https"
  #   ports: [443]
  #   description: "Verified trusted service"
  #   added_by: "admin"
  #   added_date: "2024-01-01"
  #   expires: "2024-12-31"

  rules: []

# ============================================================================
# BLACKLIST RULES (Known malicious hosts)
# ============================================================================
blacklist:
  rules:
    - domain: "*.malicious.com"
      reason: "Known malicious domain"
      added_date: "2024-01-01"

# ============================================================================
# EMERGENCY OVERRIDE
# ============================================================================
emergency:
  # Kill switch - disable ALL network access immediately
  kill_switch: false

  # Allow only localhost
  localhost_only: true

  # Emergency contacts
  contacts:
    - name: "Security Admin"
      email: "security@example.com"
