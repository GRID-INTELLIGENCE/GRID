{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Case Filing Template",
  "description": "Comprehensive template for case filing that combines all documentation elements",
  "type": "object",
  "required": ["case_id", "timestamp", "raw_input", "structured_data"],
  "properties": {
    "case_id": {
      "type": "string",
      "description": "Unique case identifier (e.g., CASE-abc123)",
      "pattern": "^CASE-[a-f0-9]{12}$"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO8601 timestamp of case creation"
    },
    "raw_input": {
      "type": "string",
      "description": "Original raw user input (client case)"
    },
    "user_id": {
      "type": ["string", "null"],
      "description": "User identifier (optional)"
    },
    "structured_data": {
      "type": "object",
      "description": "Structured case data from filing system",
      "required": ["category", "priority", "confidence"],
      "properties": {
        "timestamp": {
          "type": "string",
          "format": "date-time"
        },
        "labels": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Case labels (e.g., category:testing, priority:high)"
        },
        "category": {
          "type": "string",
          "enum": [
            "code_analysis",
            "architecture",
            "testing",
            "documentation",
            "deployment",
            "security",
            "performance",
            "bug_fix",
            "feature_request",
            "refactoring",
            "integration",
            "rare"
          ],
          "description": "Case category"
        },
        "priority": {
          "type": "string",
          "enum": ["low", "medium", "high", "critical"],
          "description": "Case priority"
        },
        "keywords": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Extracted keywords"
        },
        "entities": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Extracted entities"
        },
        "relationships": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "source": {"type": "string"},
              "target": {"type": "string"},
              "type": {"type": "string"}
            }
          },
          "description": "Detected relationships"
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Classification confidence score"
        },
        "logging_iterations": {
          "type": "array",
          "items": {"type": "object"},
          "description": "Iterative logging data"
        }
      }
    },
    "comprehensive_suite_mapping": {
      "type": "object",
      "description": "Mapping to agent evolution system components",
      "properties": {
        "category_mappings": {
          "type": "object",
          "properties": {
            "roles": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["Analyst", "Architect", "Planner", "Executor", "Evaluator", "SafetyOfficer"]
              }
            }
          }
        },
        "keyword_mappings": {
          "type": "object",
          "properties": {
            "tasks": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["/inventory", "/gapanalysis", "/plan", "/execute", "/validate", "/safety review"]
              }
            }
          }
        }
      }
    },
    "recommended_roles": {
      "type": "array",
      "items": {
        "type": "string",
        "enum": ["Analyst", "Architect", "Planner", "Executor", "Evaluator", "SafetyOfficer"]
      },
      "description": "Recommended agent roles based on case category"
    },
    "recommended_tasks": {
      "type": "array",
      "items": {
        "type": "string",
        "enum": ["/inventory", "/gapanalysis", "/plan", "/execute", "/validate", "/safety review"]
      },
      "description": "Recommended tasks based on case structure"
    },
    "recommended_workflow": {
      "type": "array",
      "items": {"type": "string"},
      "description": "Recommended workflow steps"
    },
    "context_for_agent": {
      "type": "string",
      "description": "Formatted context string for agent (lawyer)"
    },
    "user_context": {
      "type": "object",
      "description": "User-provided context",
      "properties": {
        "examples": {
          "type": "array",
          "items": {"type": "string"},
          "description": "User-provided examples"
        },
        "scenarios": {
          "type": "array",
          "items": {"type": "string"},
          "description": "User-provided scenarios"
        },
        "phenomena": {
          "type": "array",
          "items": {"type": "string"},
          "description": "User-provided phenomena"
        }
      }
    },
    "metadata": {
      "type": "object",
      "description": "Case metadata",
      "properties": {
        "category": {"type": "string"},
        "priority": {"type": "string"},
        "confidence": {"type": "number"},
        "labels": {
          "type": "array",
          "items": {"type": "string"}
        }
      }
    },
    "event_history": {
      "type": "array",
      "items": {
        "type": "string",
        "enum": [
          "case.created",
          "case.categorized",
          "case.reference_generated",
          "case.executed",
          "case.completed"
        ]
      },
      "description": "List of events emitted for this case"
    },
    "execution_data": {
      "type": "object",
      "description": "Execution data (filled after agent execution)",
      "properties": {
        "agent_role": {
          "type": "string",
          "enum": ["Analyst", "Architect", "Planner", "Executor", "Evaluator", "SafetyOfficer"]
        },
        "task": {
          "type": "string",
          "enum": ["/inventory", "/gapanalysis", "/plan", "/execute", "/validate", "/safety review"]
        },
        "solution": {"type": "string"},
        "outcome": {
          "type": "string",
          "enum": ["success", "partial", "failure"]
        },
        "execution_time_seconds": {"type": "number"}
      }
    },
    "learning_data": {
      "type": "object",
      "description": "Learning data (filled after case completion)",
      "properties": {
        "experience_metrics": {
          "type": "object",
          "properties": {
            "total_cases": {"type": "integer"},
            "success_rate": {"type": "number"},
            "category_distribution": {"type": "object"}
          }
        },
        "patterns": {
          "type": "array",
          "items": {"type": "object"}
        },
        "recommendations": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "case_id": {"type": "string"},
              "similarity": {"type": "number"},
              "recommended_solution": {"type": "string"},
              "expected_outcome": {"type": "string"}
            }
          }
        }
      }
    },
    "advanced_protocols": {
      "type": "object",
      "description": "Advanced protocol data (for rare cases)",
      "properties": {
        "protocol": {"type": "string"},
        "web_search_performed": {"type": "boolean"},
        "memory_searches": {
          "type": "array",
          "items": {"type": "object"}
        },
        "generated_queries": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "question": {"type": "string"},
              "type": {"type": "string"},
              "options": {
                "type": "array",
                "items": {"type": "string"}
              },
              "purpose": {"type": "string"}
            }
          }
        },
        "nuances": {
          "type": "array",
          "items": {"type": "string"}
        },
        "insights": {
          "type": "array",
          "items": {"type": "string"}
        }
      }
    },
    "reference_file_path": {
      "type": "string",
      "description": "Path to reference file"
    },
    "last_updated": {
      "type": "string",
      "format": "date-time",
      "description": "Last update timestamp"
    },
    "user_enrichments": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "timestamp": {"type": "string", "format": "date-time"},
          "additional_context": {"type": "string"},
          "examples": {"type": "array", "items": {"type": "string"}},
          "scenarios": {"type": "array", "items": {"type": "string"}}
        }
      },
      "description": "User enrichments added after initial processing"
    }
  }
}
